---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: crowdsec
  namespace: monitoring
spec:
  interval: 5m
  chart:
    spec:
      chart: crowdsec
      version: 0.20.1
      sourceRef:
        kind: HelmRepository
        name: crowdsecurity-charts
        namespace: flux-system
      interval: 5m

  values:
    container_runtime: containerd
    agent:
      acquisition:
        - namespace: networking
          podName: traefik-*
          program: traefik
      env:
        - name: COLLECTIONS
          value: "crowdsecurity/traefik"
    lapi:
      env:
        - name: ENROLL_KEY
          value: "${CROWDSEC_ENROLL_KEY}"
        - name: ENROLL_INSTANCE_NAME
          value: "k3s"
        - name: ENROLL_TAGS
          value: "k3s"
